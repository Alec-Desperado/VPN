# NAME: MainDirect
# UPDATED: 2025-06-24 14:35:09 UTC

# ---- ---- ----

# ShadowRocket site: https://shadowlaunch.com/

[General]

# Bypass system. If this option is disabled, it may cause some system issues such as push notification delays.
bypass-system = true


# Skip Proxy. This option forces connections to these domains or
# IP ranges to be handled by the Shadowrocket TUN interface instead of the Shadowrocket proxy server.
# This option is used to resolve some compatibility issues with some applications.
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,213.59.192.0/18,212.193.144.0/20,localhost,*.local,captive.apple.com,*.apple.com,*.icloud.com,*.itunes.com,*.ru,cid.yandex.net,stun.l.google.com


# TUN Bypass Routing. The Shadowrocket TUN interface supports only the TCP protocol.
# Use this option to bypass the specified IP address range, allowing other protocols to pass through.
tun-excluded-routes = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,213.59.192.0/18,212.193.144.0/20


# Always use a real IP address, this option requires the Shadowrocket to process DNS queries in TUN and return a real IP address instead of a spoofed IP address.
always-real-ip = *.lan,*.local


# This option allows you to return a fake IP address, such as "stun-response-ip=1.1.1.1", "stun-response-ipv6=::1",
# to prevent real IP address leakage and enhance WebRTC security. leakage and enhance WebRTC privacy and security.
stun-response-ip=1.1.1.1
stun-response-ipv6=::1


# Enable IPv6 support. false means not enabled, true means enabled.
ipv6 = true

# Prefer IPv6. Prioritize querying the IPv6 DNS server for AAAA records and using AAAA records first; false means not enabled.
prefer-ipv6 = false

# Private IP response. If this option is not enabled, domain name resolution returns a private IP address, and Shadowrocket will consider the domain name captured and force a proxy.
private-ip-answer = true

# The domain name resolves directly using system DNS; false means not enabled.
dns-direct-system = false

# Use system DNS after a DNS resolution failure; false means not enabled.
dns-fallback-system = false

# Use proxy server after direct connection domain name resolution fails; false means not enabled.
dns-direct-fallback-proxy = true

# Override DNS. Override the system default DNS using normal DNS or encrypted DNS (e.g. doh, doq, dot, etc.).
# Some DNS over https support http3, so try querying and switching to http3 if it is supported. You can add #no-h3 after the doh link to close it.
dns-server = tls://1.0.0.1,tls://1.1.1.1,tls://8.8.4.4,tls://8.8.8.8,tls://dns.google,tls://dns.quad9.net,tls://2606:4700:4700::1001,tls://[2606:4700:4700::1111]:853

# Alternate DNS. Returns to the backup DNS when the resolution of the overwritten DNS fails.
# If you need to specify multiple DNSs, you can separate them with commas. system means return to the system DNS.
# You can choose an alternative DOH/DOT - https://github.com/curl/curl/wiki/DNS-over-HTTPS
fallback-dns-server = https://1.1.1.1/dns-query#no-h3,https://8.8.8.8/dns-query#no-h3,https://cloudflare-dns.com/dns-query#no-h3

# DNS Rewrite. Some devices or software always use hard-coded DNS servers, for example Netflix sends requests through Google DNS (8.8.8.8.8 or 8.8.4.4). You can use this option to intercept requests.
hijack-dns = :53,8.8.8.8:53,8.8.4.4:53,1.1.1.1:53,1.0.0.1:53,9.9.9.9:53

# TUN contains routes. By default, the Shadowrocket interface announces itself as the default route, but because of the lesser routing of the Wi-Fi interface, some traffic may not pass through the Shadowrocket interface. Use this option to add a smaller routing table.
# tun-included-routes =

# Ping packets automatically reply.
icmp-auto-reply = true

# If the REJECT policy is not enabled, by default it will take effect only in configuration mode. Once enabled, the policy can become effective in other global routing modes.
always-reject-url-rewrite = false

# If the UDP traffic matches a host policy that does not support UDP forwarding in rules, reselect the backup behavior. Additional behavior options include DIRECT and REJECT. DIRECT means forward UDP traffic directly, and REJECT means refuse to forward UDP traffic.
udp-policy-not-supported-behaviour = REJECT

# ðŸ’¡ Network compatibility mode. `0 -> Disable`; `1 -> Proxy with Loopback Address`; `2 -> Proxy Only`; `3 -> TUN Only`. The effect when the value of the parameter is set to `3` is equivalent to enabling [Tun Mode]: Settings > Proxy > Proxy Type > None.
# compatibility-mode =

# Hide VPN Icon (off by default)
hide-vpn-icon = false

# Test timeout (seconds)
test-timeout = 10
# Internet Test URL
internet-test-url = http://www.gstatic.com/generate_204
# Proxy URL
proxy-test-url = http://cp.cloudflare.com/generate_204

# Optional. Add these addresses in the program settings Settings â†’ GeoLite2 Database
# If you do not have a Maxmind account and you are using the Proxy or Auto final rule
# country: https://git.io/GeoLite2-Country.mmdb or https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb
# asn: https://github.com/P3TERX/GeoLite.mmdb/raw/download/GeoLite2-ASN.mmdb


# ---- ---- ----

# URL to update the configuration file
update-url = https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/configs/MainDirect.conf

include = sr_ru_extended.conf

# ---- ---- ----


[Rule]

# Explanation for blocking UDP traffic on port 443: HTTP3/QUIC protocols are becoming popular,
# but domestic ISPs and international locations have low UDP priority,
# they don't work well and are blocked to force a return to HTTP2/HTTP1.1.
# (If you need to enable this logical rule, remove the # comment character before AND).
AND,((PROTOCOL,UDP),(DST-PORT,443)),REJECT-NO-DROP

# The logical rule for these two ANDs is to prevent issues
# that could cause module scripts to fail if a Spotify or YouTube related request goes UDP.
AND,((PROTOCOL,UDP),(DEST-PORT,443),(DOMAIN-SUFFIX,googlevideo.com)),REJECT-NO-DROP
AND,((PROTOCOL,UDP),(DEST-PORT,443),(DOMAIN,spclient.wg.spotify.com)),REJECT-NO-DROP

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_private.list,DIRECT

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_reject.list,REJECT
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_proxy.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_direct.list,DIRECT

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/apple-tvplus.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_apple.list,DIRECT

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_perplexity.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/bitwarden.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/reddit.list,DIRECT

# If you enable RULE-SET group_rules_category-social-media, VK will go through proxy.
# RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/vk.list,DIRECT

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_ai.list,PROXY

#RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_category-ru,DIRECT


# Rules for domains and group of domains
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_cloudflare.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_akamai.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_amazon.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_category-ipfs.list,PROXY

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_category-anticensorship.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_category-tech-media.list,PROXY

# RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_category-social-media.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_meta.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_twitter.list,PROXY

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/group_rules_category-finans-no-ru.list,PROXY

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/protonmail.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/notion.list,PROXY
RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/linkedin.list,PROXY

RULE-SET,https://raw.githubusercontent.com/Alec-Desperado/VPN/refs/heads/main/domains/rutracker.list,PROXY

# GeoIP
GEOIP,PRIVATE,DIRECT,no-resolve
GEOIP,APPLE,DIRECT,no-resolve
GEOIP,RU,DIRECT,no-resolve
GEOSITE,RU,DIRECT,no-resolve
GEOIP,TELEGRAM,DIRECT,no-resolve

GEOIP,CLOUDFLARE,PROXY,no-resolve
# GEOIP,FACEBOOK,PROXY,no-resolve
# GEOIP,GOOGLE,PROXY,no-resolve
# GEOIP,TWITTER,PROXY,no-resolve

# Final routing rule
FINAL,DIRECT



[Host]

# --- CUSTOM HOSTS ---
# > Local
localhost = 127.0.0.1
router.lan=192.168.0.1

# > IPv6
ip6-localhost = ::1 // IPv6 Localhost
ip6-loopback = ::1 // IPv6 Loopback
ip6-localnet = fe00::0 // IPv6 Link-Local
ip6-mcastprefix = ff00::0 // IPv6 Multicast
ip6-allnodes = ff02::1 // IPv6 All Nodes
ip6-allrouters = ff02::2 // IPv6 All Routers
ip6-allhosts = ff02::3 // IPv6 All Hosts

# --- CUSTOM DNS ---

# > Apple DNS
## refer: https://support.apple.com/zh-cn/HT210060
networking.apple = server:https://doh.dns.apple.com/dns-query
# *.networking.apple = server:https://doh.dns.apple.com/dns-query
# *.www-cdn.icloud.com.akadns.net = server:https://doh.dns.apple.com/dns-query
## Apple.com
*.apple.com = server:https://doh.dns.apple.com/dns-query
## iCloud.com
*.icloud.com = server:https://doh.dns.apple.com/dns-query
# *.me.com = server:https://doh.dns.apple.com/dns-query
##
# *.netcts.cdn-apple.com = server:https://doh.dns.apple.com/dns-query
# *.apple-mapkit.com = server:https://doh.dns.apple.com/dns-query
##
# *.apple=server:system
# *.apple-cloudkit.com=server:system
# *.cdn-apple.com=server:system
*.icloud-content.com=server:system
*.itunes.com=server:system

# > Alphabet
# refer: https://developers.google.com/speed/public-dns/docs/doh

# > Cloudflare
# refer: https://developers.cloudflare.com/1.1.1.1/encryption/dns-over-https/make-api-requests/

# > Encrypted DNS
dns.google = 8.8.8.8, 8.8.4.4, 2001:4860:4860::8888, 2001:4860:4860::8844 // https://dns.google/dns-query
dns64.dns.google = 2001:4860:4860::6464, 2001:4860:4860::64 // https://dns64.dns.google/dns-query
cloudflare-dns.com = 104.16.249.249, 104.16.248.249, 2606:4700::6810:f8f9, 2606:4700::6810:f9f9 // https://cloudflare-dns.com/dns-query
1dot1dot1dot1.cloudflare-dns.com = 1.1.1.1, 1.0.0.1, 2606:4700:4700::1001, 2606:4700:4700::1111 // 1dot1dot1dot1.cloudflare-dns.com:853
one.one.one.one = 1.1.1.1, 1.0.0.1, 2606:4700:4700::1001, 2606:4700:4700::1111  // one.one.one.one:853

# > Router/system DNS
*.lan = server:system
*.home.arpa = server:system
*.in-addr.arpa = server:system

# *.repeater.asus.com = server:system
# *.router.asus.com = server:system
# *.asusrouter.com = server:system
*.routerlogin.net = server:system
*.tendawifi.com = server:system
*.tplinkwifi.net = server:system
*.tplogin.cn = server:system
*.tplinkap.net = server:system
*.tplinkeap.net = server:system
*.tplinklogin.net = server:system
*.tplinkmodem.net = server:system
*.tplinkplclogin.net = server:system
*.tplinkrepeater.net = server:system
*.www.miwifi.com = server:system
# *.mediarouter.home = server:system
*.miwifi.com = server:system
# *.zte.home = server:system
# *.ui.direct = server:system
*.hiwifi.com = server:system
*.huaweimobilewifi.com = server:system
# *.my.router = server:system
# *.routerlogin.com = server:system
# *.samsung.router = server:system
# *.router.synology.com = server:system

# > Rus
*.tbank.ru=server:system
*.mts.ru=server:system
*.emias.info=server:system
*.gosuslugi.ru=server:system
*.gov.ru=server:system
*.mos.ru=server:system
*.mosreg.ru=server:system
*.nalog.ru=server:system

[URL Rewrite]
^https?://(www.)?nnmclub.to https://nnmclub.to 302
^http://(www.)?yandex.ru https://www.ya.ru 302
^https?://(www.)?google.ru https://www.google.com 302
